# Guia de Pruebas - Sprint 2 Backend
## Fecha: 2025-10-17

### Resumen

Esta guia documenta los pasos para probar la funcionalidad completa del Sprint 2 (Backend: Compilacion y Optimizacion).

---

## INSTRUCCIONES PARA PROBAR EL SPRINT 2

### Paso 1: Compilar el Proyecto

Primero, asegurar de que el proyecto este compilado:

```bash
cd C:\Users\Xpc\Documents\GitHub\Compi\proyecto1\gvega_compiladores_interpretes_2025\Proyecto\Proyecto
mvn clean compile
```

Esto generara todas las clases necesarias en el directorio target/classes.

### Paso 2: Probar la Compilacion Completa

Ejecutar el compilador con uno de los archivos de prueba:

```bash
java -cp "target/classes;C:\Users\Xpc\.m2\repository\org\antlr\antlr4-runtime\4.13.2\antlr4-runtime-4.13.2.jar" Compiler test\ejemplo3_tortuga.smp target
```

Salida esperada:

```
=== INICIANDO COMPILACION ===
Archivo de entrada: test\ejemplo3_tortuga.smp

[1/7] Analisis Lexico...
[2/7] Analisis Sintactico...
[3/7] Analisis Semantico...
Analisis semantico completado sin errores
[4/7] Generando Representacion Intermedia (TAC)...
IR generado: 21 instrucciones
   -> Guardado en: target/out.ir
[5/7] Aplicando optimizaciones...
   Pasada 1 - Constant Folding:
     * Constantes plegadas: 1
     * Instrucciones: 21
   Pasada 2 - Peephole:
     * Patrones optimizados: 0
     * Instrucciones: 21
   Pasada 3 - Dead Code Elimination:
     * Codigo muerto eliminado: 0
     * Instrucciones finales: 21

   Resumen de optimizacion:
     * Instrucciones originales: 21
     * Instrucciones optimizadas: 21
     * Reduccion: 0 instrucciones (0.0%)

[6/7] Generando codigo ensamblador...
Codigo ASM generado: 23 lineas
   -> Guardado en: target/out.asm
[7/7] Generando archivo objeto...
Archivo objeto generado
   -> Guardado en: target/out.lobj

=== COMPILACION EXITOSA ===

Para ejecutar el programa compilado:
  java -cp target/classes runtime.RuntimePlayer target/out.lobj
```

### Paso 3: Verificar Archivos Generados

Revisar que se hayan generado los siguientes archivos:

1. target/out.ir - Representacion Intermedia (TAC)
2. target/out.asm - Codigo Ensamblador
3. target/out.lobj - Archivo Objeto Ejecutable

Se puede ver el contenido con:

```bash
type target\out.ir
type target\out.asm
type target\out.lobj
```

Contenido esperado de target/out.ir:

```
=== GLOBAL ===
lado = 100
call turtle_centro, 0
call turtle_bajalapiz, 0
param "negro"
call turtle_colorlapiz, 1
t0 = 0
L0:
t1 = t0 < ?
if t1 goto L1 else goto L2
L1:
param lado
call turtle_avanza, 1
param 90
call turtle_giraderecha, 1
t2 = t0 + 1
t0 = t2
goto L0
L2:
call turtle_subelapiz, 0
param 1
call println, 1
```

Contenido esperado de target/out.asm:

```
; GLOBAL SECTION
MOV lado, 100
CALL turtle_centro, 0
CALL turtle_bajalapiz, 0
PUSH "negro"
CALL turtle_colorlapiz, 1
MOV t0, 0
label L0
BIN t1, t0, LT, ?
JMPTF t1, L1, L2
label L1
PUSH lado
CALL turtle_avanza, 1
PUSH 90
CALL turtle_giraderecha, 1
MOV t2, 1
MOV t0, t2
JMP L0
label L2
CALL turtle_subelapiz, 0
PUSH 1
CALL println, 1
```

Contenido esperado de target/out.lobj:

```
; LOBJ v1.0 - Compiled Turtle Language Object File
; Generated by Turtle Compiler

; GLOBAL SECTION
MOV lado, 100
CALL turtle_centro, 0
CALL turtle_bajalapiz, 0
PUSH "negro"
CALL turtle_colorlapiz, 1
MOV t0, 0
label L0
BIN t1, t0, LT, ?
JMPTF t1, L1, L2
label L1
PUSH lado
CALL turtle_avanza, 1
PUSH 90
CALL turtle_giraderecha, 1
MOV t2, 1
MOV t0, t2
JMP L0
label L2
CALL turtle_subelapiz, 0
PUSH 1
CALL println, 1
```

### Paso 4: Ejecutar el Programa Compilado

Ejecutar el archivo objeto con el RuntimePlayer:

```bash
java -cp "target/classes;C:\Users\Xpc\.m2\repository\org\antlr\antlr4-runtime\4.13.2\antlr4-runtime-4.13.2.jar" runtime.RuntimePlayer target\out.lobj
```

El programa debe ejecutarse sin errores. No habra salida visible en consola para este ejemplo especifico, pero el programa se ejecuta correctamente.

### Paso 5: Probar Otros Ejemplos

Se puede probar con otros archivos de ejemplo:

```bash
java -cp "target/classes;C:\Users\Xpc\.m2\repository\org\antlr\antlr4-runtime\4.13.2\antlr4-runtime-4.13.2.jar" Compiler test\ejemplo2_funciones.smp target
```

---

## VERIFICACION DE REQUISITOS DEL SPRINT 2

A continuacion se listan los requisitos del Sprint 2 y como verificarlos:

### Requisito 1: Captura del programa sin ejecutar

Verificacion:
- Revisar que el archivo Compiler.java use parser.captureProgramBody = true
- Confirmar que no se ejecuta el AST durante la compilacion
- El programa debe generar IR sin imprimir resultados de ejecucion

Comando para verificar:
```bash
java -cp "target/classes;C:\Users\Xpc\.m2\repository\org\antlr\antlr4-runtime\4.13.2\antlr4-runtime-4.13.2.jar" Compiler test\ejemplo3_tortuga.smp target
```

Resultado esperado: No se ve "1" impreso durante la compilacion (solo durante ejecucion con RuntimePlayer)

### Requisito 2: IR (TAC) minimalista

Verificacion:
- Revisar que el archivo target/out.ir contenga instrucciones TAC
- Verificar variables temporales (t0, t1, t2, ...)
- Verificar etiquetas de control de flujo (L0, L1, L2, ...)
- Verificar instrucciones basicas: asignaciones, operaciones binarias, saltos, llamadas

Comando para verificar:
```bash
type target\out.ir
```

Elementos a buscar:
- Asignaciones: lado = 100
- Operaciones: t1 = t0 < ?
- Saltos condicionales: if t1 goto L1 else goto L2
- Llamadas: call turtle_centro, 0
- Parametros: param lado

### Requisito 3: Traductor AST a IR

Verificacion:
- Confirmar que IRBuilder.java existe en el paquete ir/
- Verificar que el IR generado corresponde al codigo fuente
- Comparar el archivo .smp con el archivo .ir generado

Comando para verificar:
```bash
type test\ejemplo3_tortuga.smp
type target\out.ir
```

Verifica que:
- Las variables del codigo fuente aparecen en el IR
- Los bucles se traducen a etiquetas y saltos
- Las operaciones aritmeticas se descomponen en instrucciones simples

### Requisito 4: Optimizaciones

Verificacion:
- La salida del compilador debe mostrar las 3 pasadas de optimizacion
- Constant Folding debe reportar constantes plegadas
- Peephole debe reportar patrones optimizados
- Dead Code Elimination debe reportar codigo eliminado

Comando para verificar:
```bash
java -cp "target/classes;C:\Users\Xpc\.m2\repository\org\antlr\antlr4-runtime\4.13.2\antlr4-runtime-4.13.2.jar" Compiler test\ejemplo3_tortuga.smp target
```

Buscar en la salida:
```
[5/7] Aplicando optimizaciones...
   Pasada 1 - Constant Folding:
     * Constantes plegadas: X
   Pasada 2 - Peephole:
     * Patrones optimizados: X
   Pasada 3 - Dead Code Elimination:
     * Codigo muerto eliminado: X
```

### Requisito 5: Generacion de archivo objeto

Verificacion:
- Confirmar que se genera el archivo target/out.lobj
- Verificar que el archivo comienza con el encabezado correcto
- Confirmar que contiene codigo ASM ejecutable

Comando para verificar:
```bash
type target\out.lobj | findstr /C:"LOBJ v1.0"
```

El archivo debe empezar con:
```
; LOBJ v1.0 - Compiled Turtle Language Object File
; Generated by Turtle Compiler
```

### Requisito 6: Runner

Verificacion:
- Ejecutar el RuntimePlayer con el archivo .lobj
- Verificar que no hay errores de ejecucion
- Confirmar que el programa se comporta como se espera

Comando para verificar:
```bash
java -cp "target/classes;C:\Users\Xpc\.m2\repository\org\antlr\antlr4-runtime\4.13.2\antlr4-runtime-4.13.2.jar" runtime.RuntimePlayer target\out.lobj
```

Resultado esperado: Ejecucion sin excepciones ni errores

### Requisito 7: Integracion en Main

Verificacion:
- Confirmar que Compiler.java existe y funciona independientemente
- Verificar que Main.java (interprete) sigue funcionando
- Ejecutar ambos para confirmar que son independientes

Comando para verificar el compilador:
```bash
java -cp "target/classes;C:\Users\Xpc\.m2\repository\org\antlr\antlr4-runtime\4.13.2\antlr4-runtime-4.13.2.jar" Compiler test\ejemplo3_tortuga.smp target
```

Comando para verificar el interprete:
```bash
java -cp "target/classes;C:\Users\Xpc\.m2\repository\org\antlr\antlr4-runtime\4.13.2\antlr4-runtime-4.13.2.jar" Main dummy test\ejemplo3_tortuga.smp
```

### Requisito 8: Pruebas y artefactos

Verificacion:
- Confirmar que existen archivos de prueba en test/
- Verificar que la compilacion genera los 3 archivos esperados
- Confirmar que los archivos son consistentes entre si

Comandos para verificar:
```bash
dir test\*.smp
dir target\out.*
```

Archivos esperados:
- test/ejemplo3_tortuga.smp (y otros)
- target/out.ir
- target/out.asm
- target/out.lobj

### Requisito 9: Documentacion

Verificacion:
- Confirmar que existe docs/sprint2_resumen.md
- Verificar que el documento contiene:
  * DiseÃ±o del IR
  * Explicacion de optimizaciones
  * Formato .lobj
  * Ejemplos de uso
  * Instrucciones de compilacion

Comando para verificar:
```bash
type docs\sprint2_resumen.md
```

---

## RESUMEN DE COMANDOS DE PRUEBA

### Compilacion del proyecto
```bash
mvn clean compile
```

### Compilar un programa
```bash
java -cp "target/classes;C:\Users\Xpc\.m2\repository\org\antlr\antlr4-runtime\4.13.2\antlr4-runtime-4.13.2.jar" Compiler test\ejemplo3_tortuga.smp target
```

### Ver archivos generados
```bash
type target\out.ir
type target\out.asm
type target\out.lobj
```

### Ejecutar programa compilado
```bash
java -cp "target/classes;C:\Users\Xpc\.m2\repository\org\antlr\antlr4-runtime\4.13.2\antlr4-runtime-4.13.2.jar" runtime.RuntimePlayer target\out.lobj
```

### Ejecutar interprete (para comparacion)
```bash
java -cp "target/classes;C:\Users\Xpc\.m2\repository\org\antlr\antlr4-runtime\4.13.2\antlr4-runtime-4.13.2.jar" Main dummy test\ejemplo3_tortuga.smp
```

---

## CHECKLIST DE VERIFICACION

Marca cada item cuando lo hayas verificado:

[ ] El proyecto compila sin errores con mvn clean compile
[ ] El compilador ejecuta las 7 fases correctamente
[ ] Se genera el archivo target/out.ir con formato TAC correcto
[ ] Se genera el archivo target/out.asm con codigo ensamblador
[ ] Se genera el archivo target/out.lobj con formato correcto
[ ] Las 3 optimizaciones se ejecutan y reportan metricas
[ ] El RuntimePlayer ejecuta archivos .lobj sin errores
[ ] El interprete (Main.java) sigue funcionando independientemente
[ ] La documentacion en docs/sprint2_resumen.md es completa
[ ] Los archivos de prueba en test/ funcionan correctamente

---

## PROBLEMAS COMUNES Y SOLUCIONES

### Problema: Error "Cannot find or load main class Compiler"

Solucion: Asegurar de que el proyecto este compilado:
```bash
mvn clean compile
```

### Problema: Error "NoClassDefFoundError: org/antlr/v4/runtime/CharStream"

Solucion: Incluye el JAR de ANTLR en el classpath:
```bash
java -cp "target/classes;C:\Users\Xpc\.m2\repository\org\antlr\antlr4-runtime\4.13.2\antlr4-runtime-4.13.2.jar" Compiler ...
```

### Problema: Archivos no se generan en target/

Solucion: Verificar que el directorio target existe y que tienes permisos de escritura:
```bash
mkdir target
```

### Problema: Errores de sintaxis al compilar archivos .smp

Solucion: Verificar que el archivo use la sintaxis correcta del lenguaje. Revisa los ejemplos en test/ como referencia.


